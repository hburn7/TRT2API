## The Roundtable II API
This API is used by The Roundtable II website & gosumemory stream overlay. This API functions as a bridge between these services and a central PostgreSQL database.

## Usage
Setup is straightforward.

* Clone the repository: ```git clone https://github.com/hburn7/TRT2API.git && cd TRT2API```
* Run the project via the dotnet CLI (note, CD to the folder containing the `.csproj` file): `cd TRT2API && dotnet run`
* Configure a PostgreSQL database and update the connection string in `appsettings.json` (replace values in example appsettings.json)
* Run the provided database scripts to create the necessary tables
* Query an endpoint on the running port: `GET https://localhost:44395/api/players/all` for example

# Database
Run the db.sql script into your PostgreSQL instance. This will create the necessary tables for the API to function.

# Routes & Endpoints
All data will be returned as a JSON object. All success response codes are 200.

## GET
**Players:** `/api/players`
* `/all` - Returns all players in the database.

```json
[
  {
    "id": 2,
    "playerID": 123456,
    "playerName": "ROB_",
    "totalWins": 0,
    "totalLosses": 1,
    "status": "get owned",
    "isEliminated": true
  },
  {
    "id": 1,
    "playerID": 12345,
    "playerName": "Stage",
    "totalWins": 4,
    "totalLosses": 0,
    "status": "this is a test status",
    "isEliminated": false
  }
]
```

* `/{playerID}` - Returns a single player for the given ID. Returns status code 400 if the specified playerID does not belong to any player.

```json
{
  "id": 1,
  "playerID": 12345,
  "playerName": "Stage",
  "totalWins": 4,
  "totalLosses": 0,
  "status": "this is a test status",
  "isEliminated": false
}
```

* `/{playerID}/matches` - This endpoint returns all matches involving the player with the given player ID. Returns an empty array if the player has not participated in any matches. Returns status code 400 if the specified ID does not belong to any player.

For example, the following might be a typical response for `/api/players/12345/matches`:
```json
[
  {
    "id": 1,
    "matchID": 894152,
    "playerIDs": [
      12345,
      123456
    ],
    "winnerID": 12345,
    "timeStart": "2023-06-17T23:59:59"
  },
  {
    "id": 2,
    "matchID": 513551,
    "playerIDs": [
      12345,
      123456
    ],
    "winnerID": null,
    "timeStart": "2023-06-23T11:03:27"
  }
]
```

This shows that player 12345 has been involved in two matches.

**Matches:** `/api/matches`
* `/all` - Returns all matches in the database.

```json
[
  {
    "id": 1,
    "matchID": 894152,
    "playerIDs": [
      12345,
      123456
    ],
    "winnerID": 12345, // Represents a completed match
    "timeStart": "2023-06-17T23:59:59"
  },
  {
    "id": 2,
    "matchID": 513551,
    "playerIDs": [
      12345,
      123456
    ],
    "winnerID": null, // (no winner yet, players scheduled)
    "timeStart": "2023-06-23T11:03:27" // Represents a future match
  }
]
```

* `/{matchID}` - Returns a single match for the given ID. Returns status code 400 if the specified ID does not belong to any match.

```json
{
  "id": 1,
  "matchID": 894152,
  "playerIDs": [
    12345,
    123456
  ],
  "winnerID": 12345,
  "timeStart": "2023-06-17T23:59:59"
}
```

* `/{matchID}/players` - Returns all players involved in the match with the given match ID. Returns status code 400 if the specified ID does not belong to any match.

```json
[
  {
    "id": 1,
    "playerID": 12345,
    "playerName": "Stage",
    "totalWins": 4,
    "totalLosses": 0,
    "status": "this is a test status"
  },
  {
    "id": 2,
    "playerID": 123456,
    "playerName": "ROB_",
    "totalWins": 0,
    "totalLosses": 1,
    "status": "get owned"
  }
]
```

## POST
**Players:** `/api/players`

* `/add` - Adds a new player to the database. The request body must contain a JSON object with the following properties:
  * `playerID` - The player's osu! ID
  * `playerName` - The player's osu! username
  * `totalWins` - The player's total wins (BR stat)
  * `totalLosses` - The player's total losses (BR stat)
  * `status` - Any message that represents the player's "status"
  * `isEliminated` - Whether or not the player is eliminated

Returns the number of database rows updated. 0 represents a failure, 1 represents success. Returns status code 409 if the specified player ID already exists in the database or the operation fails for some other reason.

Post body: *Note, don't include "id" as this is generated by the database.*

```json
{
  "playerID": 123,
  "playerName": "JohnDoe",
  "totalWins": 0,
  "totalLosses": 0,
  "status": "some status",
  "isEliminated": false
}
```

* `/update` - Updates an existing player in the database. Format and error codes are the exact same as `/add`. If the player does not exist, 404 is returned. If 404 is returned, the operation is nullified and the update will be lost.